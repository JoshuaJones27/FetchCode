et f=0;f<a.length;++f)tf(a[f]).then(g=>{d[f]=g;e--;0===e&&b(d)}).catch(g=>{c(g)})}))}static reject(a){return new uf(new sf((b,c)=>{c(a)}))}then(a,b){const c=null!=a?a:rf,d=null!=b?b:qf;
return new uf(new sf((e,f)=>{"PENDING"===this.state.status?(this.i.push(()=>{vf(this,this,c,e,f)}),this.onRejected.push(()=>{xf(this,this,d,e,f)})):"FULFILLED"===this.state.status?vf(this,this,c,e,f):"REJECTED"===this.state.status&&xf(this,this,d,e,f)}))}catch(a){return this.then(void 0,a)}};function yf(a,b,c){const d=()=>{try{a.removeEventListener("success",e),a.removeEventListener("error",f)}catch(g){}},e=()=>{b(a.result);
d()},f=()=>{c(a.error);
d()};
a.addEventListener("success",e);a.addEventListener("error",f)}
function zf(a){return new Promise((b,c)=>{yf(a,b,c)})}
function T(a){return new uf(new sf((b,c)=>{yf(a,b,c)}))}
;function Af(a,b){return new uf(new sf((c,d)=>{const e=()=>{const f=a?b(a):null;f?f.then(g=>{a=g;e()},d):c()};
e()}))}
;function Bf(a,b,c,d){return r(function*(){const e={mode:"readonly",H:!1,tag:"IDB_TRANSACTION_TAG_UNKNOWN"};"string"===typeof c?e.mode=c:Object.assign(e,c);a.transactionCount++;const f=e.H?3:1;let g=0,h;for(;!h;){g++;const l=Math.round(R());try{const m=a.i.transaction(b,e.mode);var k=d;const p=new Cf(m),t=yield Df(p,k),n=Math.round(R());Ef(a,l,n,g,void 0,b.join(),e);return t}catch(m){k=Math.round(R());const p=of(m,a.i.name,b.join(),a.i.version);if(p instanceof S&&!p.i||g>=f)Ef(a,l,k,g,p,b.join(),e),
h=p}}return Promise.reject(h)})}
function Ff(a,b,c){a=a.i.createObjectStore(b,c);return new Gf(a)}
function Hf(a,b,c,d){return Bf(a,[b],{mode:"readwrite",H:!0},e=>{e=e.objectStore(b);return T(e.i.put(c,d))})}
function Ef(a,b,c,d,e,f,g){b=c-b;e?(e instanceof S&&("QUOTA_EXCEEDED"===e.type||"QUOTA_MAYBE_EXCEEDED"===e.type)&&cf("QUOTA_EXCEEDED",{dbName:gf(a.i.name),objectStoreNames:f,transactionCount:a.transactionCount,transactionMode:g.mode}),e instanceof S&&"UNKNOWN_ABORT"===e.type&&(c-=a.l,0>c&&c>=Math.pow(2,31)&&(c=0),cf("TRANSACTION_UNEXPECTEDLY_ABORTED",{objectStoreNames:f,transactionDuration:b,transactionCount:a.transactionCount,dbDuration:c}),a.j=!0),If(a,!1,d,f,b,g.tag),bf(e)):If(a,!0,d,f,b,g.tag)}
function If(a,b,c,d,e,f="IDB_TRANSACTION_TAG_UNKNOWN"){cf("TRANSACTION_ENDED",{objectStoreNames:d,connectionHasUnknownAbortedTransaction:a.j,duration:e,isSuccessful:b,tryCount:c,tag:f})}
var Jf=class{constructor(a,b){this.i=a;this.options=b;this.transactionCount=0;this.l=Math.round(R());this.j=!1}add(a,b,c){return Bf(this,[a],{mode:"readwrite",H:!0},d=>d.objectStore(a).add(b,c))}clear(a){return Bf(this,[a],{mode:"readwrite",
H:!0},b=>b.objectStore(a).clear())}close(){this.i.close();
let a;(null==(a=this.options)?0:a.closed)&&this.options.closed()}count(a,b){return Bf(this,[a],{mode:"readonly",H:!0},c=>c.objectStore(a).count(b))}delete(a,b){return Bf(this,[a],{mode:"readwrite",
H:!0},c=>c.objectStore(a).delete(b))}get(a,b){return Bf(this,[a],{mode:"readonly",
H:!0},c=>c.objectStore(a).get(b))}objectStoreNames(){return Array.from(this.i.objectStoreNames)}};
function Kf(a,b,c){a=a.i.openCursor(b.query,b.direction);return Lf(a).then(d=>Af(d,c))}
function Mf(a,b){return Kf(a,{query:b},c=>c.delete().then(()=>c.continue())).then(()=>{})}
var Gf=class{constructor(a){this.i=a}add(a,b){return T(this.i.add(a,b))}autoIncrement(){return this.i.autoIncrement}clear(){return T(this.i.clear()).then(()=>{})}count(a){return T(this.i.count(a))}delete(a){return a instanceof IDBKeyRange?Mf(this,a):T(this.i.delete(a))}get(a){return T(this.i.get(a))}index(a){try{return new Nf(this.i.index(a))}catch(b){if(b instanceof Error&&"NotFoundError"===b.name)throw new mf(a,this.i.name);
throw b;}}keyPath(){return this.i.keyPath}};function Df(a,b){const c=new Promise((d,e)=>{try{b(a).then(f=>{d(f)}).catch(e)}catch(f){e(f),a.abort()}});
return Promise.all([c,a.done]).then(([d])=>d)}
var Cf=class{constructor(a){this.i=a;this.l=new Map;this.j=!1;this.done=new Promise((b,c)=>{this.i.addEventListener("complete",()=>{b()});
this.i.addEventListener("error",d=>{d.currentTarget===d.target&&c(this.i.error)});
this.i.addEventListener("abort",()=>{var d=this.i.error;if(d)c(d);else if(!this.j){d=S;var e=this.i.objectStoreNames;const f=[];for(let g=0;g<e.length;g++){const h=e.item(g);if(null===h)throw Error("Invariant: item in DOMStringList is null");f.push(h)}d=new d("UNKNOWN_ABORT",{objectStoreNames:f.join(),dbName:this.i.db.name,mode:this.i.mode});c(d)}})})}abort(){this.i.abort();
this.j=!0;throw new S("EXPLICIT_ABORT");}objectStore(a){a=this.i.objectStore(a);let b=this.l.get(a);b||(b=new Gf(a),this.l.set(a,b));return b}};function Of(a,b,c){const {query:d=null,direction:e="next"}=b;a=a.i.openCursor(d,e);return Lf(a).then(f=>Af(f,c))}
var Nf=class{constructor(a){this.i=a}count(a){return T(this.i.count(a))}delete(a){return Of(this,{query:a},b=>b.delete().then(()=>b.continue()))}get(a){return T(this.i.get(a))}getKey(a){return T(this.i.getKey(a))}keyPath(){return this.i.keyPath}unique(){return this.i.unique}};
function Lf(a){return T(a).then(b=>b?new Pf(a,b):null)}
var Pf=class{constructor(a,b){this.request=a;this.cursor=b}advance(a){this.cursor.advance(a);return Lf(this.request)}continue(a){this.cursor.continue(a);return Lf(this.request)}delete(){return T(this.cursor.delete()).then(()=>{})}getKey(){return this.cursor.key}da(){return this.cursor.value}update(a){return T(this.cursor.update(a))}};function Qf(a,b,c){return new Promise((d,e)=>{let f;f=void 0!==b?self.indexedDB.open(a,b):self.indexedDB.open(a);const g=c.blocked,h=c.blocking,k=c.La,l=c.upgrade,m=c.closed;let p;const t=()=>{p||(p=new Jf(f.result,{closed:m}));return p};
f.addEventListener("upgradeneeded",n=>{try{if(null===n.newVersion)throw Error("Invariant: newVersion on IDbVersionChangeEvent is null");if(null===f.transaction)throw Error("Invariant: transaction on IDbOpenDbRequest is null");n.dataLoss&&"none"!==n.dataLoss&&cf("IDB_DATA_CORRUPTED",{reason:n.dataLossMessage||"unknown reason",dbName:gf(a)});const x=t(),z=new Cf(f.transaction);l&&l(x,G=>n.oldVersion<G&&n.newVersion>=G,z);
z.done.catch(G=>{e(G)})}catch(x){e(x)}});
f.addEventListener("success",()=>{const n=f.result;h&&n.addEventListener("versionchange",()=>{h(t())});
n.addEventListener("close",()=>{cf("IDB_UNEXPECTEDLY_CLOSED",{dbName:gf(a),dbVersion:n.version});k&&k()});
d(t())});
f.addEventListener("error",()=>{e(f.error)});
g&&f.addEventListener("blocked",()=>{g()})})}
function Rf(a,b,c={}){return Qf(a,b,c)}
function Sf(a,b={}){return r(function*(){try{const c=self.indexedDB.deleteDatabase(a),d=b.blocked;d&&c.addEventListener("blocked",()=>{d()});
yield zf(c)}catch(c){throw of(c,a,"",-1);}})}
;function Tf(a){return new Promise(b=>{Ue(()=>{b()},a)})}
function Uf(a,b){return new S("INCOMPATIBLE_DB_VERSION",{dbName:a.name,oldVersion:a.options.version,newVersion:b})}
function Vf(a){if(!a.m)throw Uf(a);if(a.i)return a.i;let b;const c=()=>{a.i===b&&(a.i=void 0)},d={blocking:f=>{f.close()},
closed:c,La:c,upgrade:a.options.upgrade},e=()=>r(function*(){var f,g=null!=(f=Error().stack)?f:"";try{const k=yield a.l(a.name,a.options.version,d);f=k;var h=a.options;const l=[];for(const m of Object.keys(h.P)){const {T:p,Ib:t=Number.MAX_VALUE}=h.P[m];!(f.i.version>=p)||f.i.version>=t||f.i.objectStoreNames.contains(m)||l.push(m)}if(0!==l.length){const m=Object.keys(a.options.P),p=k.objectStoreNames();if(a.u<se("ytidb_reopen_db_retries",0))return a.u++,k.close(),bf(new S("DB_REOPENED_BY_MISSING_OBJECT_STORES",
{dbName:a.name,expectedObjectStores:m,foundObjectStores:p})),e();if(a.o<se("ytidb_remake_db_retries",1))return a.o++,Q("ytidb_remake_db_enable_backoff_delay")&&(yield Tf(a.j),a.j*=2),yield a.delete(),bf(new S("DB_DELETED_BY_MISSING_OBJECT_STORES",{dbName:a.name,expectedObjectStores:m,foundObjectStores:p})),e();throw new lf(p,m);}return k}catch(k){if(k instanceof DOMException?"VersionError"===k.name:"DOMError"in self&&k instanceof DOMError?"VersionError"===k.name:k instanceof Object&&"message"in k&&
"An attempt was made to open a database using a lower version than the existing version."===k.message){g=yield a.l(a.name,void 0,Object.assign({},d,{upgrade:void 0}));h=g.i.version;if(void 0!==a.options.version&&h>a.options.version+1)throw g.close(),a.m=!1,Uf(a,h);return g}c();k instanceof Error&&!Q("ytidb_async_stack_killswitch")&&(k.stack=`${k.stack}\n${g.substring(g.indexOf("\n")+1)}`);let l;throw of(k,a.name,"",null!=(l=a.options.version)?l:-1);}});
b=e();a.i=b;return a.i}
function Wf(a,b){if(!b)throw pf("openWithToken",gf(a.name));return Vf(a)}
var Xf=class{constructor(a,b){this.name=a;this.options=b;this.m=!0;this.u=this.o=0;this.j=500}l(a,b,c={}){return Rf(a,b,c)}delete(a={}){return Sf(this.name,a)}};const Yf=new Xf("YtIdbMeta",{P:{databases:{T:1}},upgrade(a,b){b(1)&&Ff(a,"databases",{keyPath:"actualName"})}});function Zf(a,b){return r(function*(){return Bf(yield Wf(Yf,b),["databases"],{H:!0,mode:"readwrite"},c=>{const d=c.objectStore("databases");return d.get(a.actualName).then(e=>{if(e?a.actualName!==e.actualName||a.publicName!==e.publicName||a.userIdentifier!==e.userIdentifier:1)return T(d.i.put(a,void 0)).then(()=>{})})})})}
function $f(a,b){return r(function*(){if(a)return(yield Wf(Yf,b)).delete("databases",a)})}
;let ag;const bg=new class{constructor(){}}(new class{constructor(){}});function cg(){return r(function*(){return!0})}
function dg(){if(void 0!==ag)return ag;af=!0;return ag=cg().then(a=>{af=!1;return a})}
function eg(){const a=v("ytglobal.idbToken_")||void 0;return a?Promise.resolve(a):dg().then(b=>{(b=b?bg:void 0)&&w("ytglobal.idbToken_",b);return b})}
;new Vc;function fg(a){try{ef();var b=!0}catch(c){b=!1}if(!b)throw a=new S("AUTH_INVALID",{dbName:a}),bf(a),a;b=ef();return{actualName:`${a}:${b}`,publicName:a,use